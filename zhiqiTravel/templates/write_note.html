{% extends 'userbase.html' %}
{% load staticfiles %}
{% block title %}发布游记{% endblock %}
{% block content %}
<!-----------------发布封面---------------->

    <form method="post" action="{% url 'diarys:write' %}" enctype="multipart/form-data">
<div id="write_cover" style="background:url({% static 'images/1458530382234p1aebir9i21s4q2hiiso1ip6msf29.jpg' %});background-size: 100% 100%;">
    <div class="replace_cover"><label><a>
        更换封面
        <input name="image" type="file" id="xdaTanFileImg" onchange="xmTanUploadImg(this)" style="display: none"/>
        </a></label></div>
	<div class="replace_name">
        <div class="cw1000">
            <input name="title" type="text" placeholder="填写游记标题" maxlength="48" />
        </div>
    </div>
</div>
<!-----------------框架---------------->
<div class="cw1000">
{{ forms.media }}
    <form action="" method="post">
<div class="formRow">
    <div class="formRight">
        {{ forms }}
    </div>
    <div class="clear"></div>
</div>
</form>
{#	<img style="margin-top:30px;" src="images/bjq.jpg"/>#}
	<!-----------------发布按钮---------------->
	<div id="write_button">
		<a class="exit" href="#" onclick="javascript:history.back(-1);">退出</a>
        {% csrf_token %}
		<input class="express" type="submit" href="#" value="发表" />
		<span>或</span>
		<input class="save" type="submit" href="#" value="保存草稿" />
		<div class="clear"></div>
	</div>
</div>
    </form>
{% endblock %}

{% block script %}
    <script type="text/javascript">
            //选择图片，马上预览
            function xmTanUploadImg(obj) {
                var file = obj.files[0];

                console.log(obj);console.log(file);
                console.log("file.size = " + file.size);  //file.size 单位为byte

                var reader = new FileReader();
                reader.onload = function (e) {
                    var bg = document.getElementById("write_cover");
                    bg.style.background = "url(" + e.target.result + ")";
                    bg.style.backgroundSize = '100% 100%';
                }

                reader.readAsDataURL(file)
            }
        </script>

    <script>
    $(".express").click(function(){
        $.ajaxSetup({headers: {"X-CSRFToken": '{{ csrf_token }}'}});
        var ue = UE.getEditor('container');
        content=ue.getContent();
        $.post("{% url 'diarys:write' %}",{content:content},function(result){
            $("span").html(result);
        });
    });
    </script>
{% endblock %}